

<!-- {# Switching table for generating data inventory sections.
     Call "{{ inventory('mystage') }}" in a markdown file, 
     where 'mystage is the stage name defined here. 

     Define here, for each stage, the spreadsheet to pull from,
     the section title to appear with the fields, the type of 
     field to include in that section, and whether or not you
     want an expandable. '  

     This whole macro should be drastically changed to be more 
     DRY. #} !-->

{% macro inventory(stage, availability, expand='no', size='1x') -%}

{% if stage == 'callforservice' %}
{{ expandable(stage, callforservice_fields, availability, expand, size) }}
{% endif %}

{% if stage == 'incidents' %}
{{ expandable(stage, incidents_fields, availability, expand, size) }}
{% endif %}

{% if stage == 'arrest' %}
{{ expandable(stage, arrest_fields, availability, expand, size) }}
{% endif %}

{% if stage == 'jail' %}
{{ expandable(stage, jail_fields, availability, expand, size) }}
{% endif %}

{% if stage == 'court' %}
{{ expandable(stage, court_fields, availability, expand, size) }}
{% endif %}

{% if stage == 'prison' %}
{{ expandable(stage, prison_fields, availability, expand, size) }}
{% endif %}

{%- endmacro %}


<!-- Lower level mechanism for creating expandable sections. -->

{% macro expandable(stage, spreadsheet, availability, expand, size) -%}
<div id="{{stage}}-{{availability}}" 
{% if expand == 'expand' %} 
  class="expandable expandable-{{size}}"
{% endif %}
>
<ul>
{% for field in spreadsheet %}
{% if field.availability == availability %}
<li>{{ field.name }}</li>
{% endif %}
{% endfor %}
</ul>
</div>
{%- endmacro %}
